{"mode":"block","xmlText":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"ai_event_forever\" id=\"476+L,b7`_XJF_cC5H%/\" x=\"-762\" y=\"-637\"><statement name=\"ONSTART\"><block type=\"ai_mqtt_connect_default_servers\" id=\"ZL#*BXK3k$,W0)wsex][\"><field name=\"SERVER\">mqtt.ohstem.vn:8084</field><value name=\"USERNAME\"><shadow type=\"text\" id=\"x[r,6*YH`}TW].r.`C(k\"><field name=\"TEXT\">grassnhi_home</field></shadow></value><value name=\"KEY\"><shadow type=\"text\" id=\"UrJEuYGgY@JG7yq9f$y.\"><field name=\"TEXT\"></field></shadow></value><next><block type=\"ai_speech_rec_event\" id=\"*KHw~:iQ#iYM%z!I6H`D\"><field name=\"language\">vi-VN</field><statement name=\"event_handler\"><block type=\"ai_display_background\" id=\"O$On7_oo$Ls/rB8;f;@0\"><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"C[krzy|Whnyi:(rdV9_}\"><field name=\"COLOUR\">#ffffff</field></shadow></value><next><block type=\"ai_display_text\" id=\"w:2E@#YQ.gahW7k^7?Jx\"><value name=\"TEXT\"><shadow type=\"text\" id=\"HhV.cw:oD6bSk;cYWGwE\"><field name=\"TEXT\">Hello</field></shadow><block type=\"ai_speech_rec_result\" id=\"-sGKraGA1koJ%MTs-/RO\"></block></value><value name=\"X\"><shadow type=\"math_number\" id=\"0~_Bon|I*lD]m,zGQ@ws\"><field name=\"NUM\">100</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"v$v.)|m_am~^~khhV^O$\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"controls_if\" id=\"*eBVcVkZ673OTKmw@8Hm\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"D5jA8_nOi=#3g*u7#P5g\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"x~$g|NGnVEY%W]lpZoPY\"><value name=\"check_values\"><shadow type=\"text\" id=\"ov@LA/NtSZ{+krw1@Z~=\"><field name=\"TEXT\">bật,mở</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"*9ElTFAX`zctSEgUt[J:\"><value name=\"check_values\"><shadow type=\"text\" id=\"x~E%NwMW3/S[eWO9eYdB\"><field name=\"TEXT\">đèn</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"|]_^tvwffm4@J(iEEvyA\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"r_kC,1;K{2.{Bi`uQclO\"><field name=\"TEXT\">1</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"S4)vJ@y}PAHZI.Z8,:^k\"><field name=\"TEXT\">V10</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"t8F:K91,sbN%OEmVXqN4\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_operation\" id=\"|Q2O%3?VPyvPG#z-;|`a\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"A59m2|Bc%eVon@]gM~o`\"><value name=\"check_values\"><shadow type=\"text\" id=\"Nv0rpARCpO#$o~mf$i/N\"><field name=\"TEXT\">tắt</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"ax2iUF!MgynBa[M.*8Lb\"><value name=\"check_values\"><shadow type=\"text\" id=\"=s1:B8YO+/dnVw!bAt8t\"><field name=\"TEXT\">đèn</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"xT%Hvl_N~P)`Gp;*Cs2-\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"_Han*Niq(Zj+-1^U9Cnf\"><field name=\"TEXT\">0</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"T;[ZVkIFmFi7_9hP_K2+\"><field name=\"TEXT\">V10</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"ai_mqtt_publish\" id=\"LY~u%Od/_0!V0vLc.{^S\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"vO.FR#dVN]J,e%)^o{c2\"><field name=\"TEXT\">Tôi không hiểu</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"TU]4(JzEyV_sdb_mi`Bh\"><field name=\"TEXT\">V13</field></shadow></value></block></statement></block></next></block></next></block></next></block></statement><next><block type=\"ai_speech_rec_event_mode\" id=\"`955S3y~+7]8j`wpd8cq\"><field name=\"mode\">true</field></block></next></block></next></block></statement></block></xml>","javascript":"function mqtt_check_connection() {\n  client.on(\"connect\", function () {\n    console.log(\"Connected\")\n  })\n}\n\nfunction mqtt_check_message() {\n  client.on(\"message\", (topic, message, packet) => {\n    console.log(\"Received Message: \" + message.toString() + \" on topic: \" + topic)\n  })\n}\n\nfunction mqtt_subscribe(topic) {\n  client.subscribe(options.username + /feeds/ + topic, { qos: 0 }, function (error, granted) {\n    if (error) {\n      console.log(error)\n    } else {\n      console.log(`${granted[0].topic} was subscribed`)\n    }\n  })\n}\n\nfunction mqtt_publish(topic, msg) {\n  client.publish(options.username + /feeds/ + topic, msg, { qos: 0, retain: false }, function (error) {\n    if (error) {\n      console.log(error)\n    } else {\n      console.log(\"Published\")\n    }\n  })\n}\n\nfunction p5speechRecGotResult() {\n  background('#ffffff');\n  text((p5SpeechRec.resultString.toLowerCase()) , 100, 250);\n  if (new RegExp('bật,mở'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('đèn'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('V10', '1')\n  }\n  if (new RegExp('tắt'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('đèn'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('V10', '0')\n  } else {\n    mqtt_publish('V13', 'Tôi không hiểu')\n  }\n\n}\n\nfunction p5speechRecOnEnd() {\n  p5SpeechRec.start();\n}\n\nfunction sleep(s) {\n  ms = s * 1000\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n\nconst clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8);\n\nconst host = 'wss://mqtt.ohstem.vn:8084'\n\nconst options = {clean: true,connectTimeout: 4000,clientId: clientId,username: 'grassnhi_home',password: ''}\n\nconst client = mqtt.connect(host, options);\n\nlet p5SpeechRec = new p5.SpeechRec(\"vi-VN\", p5speechRecGotResult);\np5SpeechRec.onEnd = p5speechRecOnEnd;\np5SpeechRec.continuous = true; // do continuous recognition\n\nfunction preload() {\n\n}\n\nfunction setup() {\n  createCanvas(window.parent.document.getElementById('js-runner-container').offsetWidth-50, window.parent.document.getElementById('js-runner-container').offsetHeight-50);\n\n  mqtt_check_connection()\n  p5SpeechRec.start(); // start listening\n\n}\n\nfunction draw() {\n\n}\n","name":"voice2","extensions":[],"device":"ai"}